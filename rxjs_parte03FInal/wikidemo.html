<!doctype html>
<!-- 
   Tomado de  https://github.com/Reactive-Extensions/RxJS 
   Para el API de Wikipedia ver https://www.mediawiki.org/wiki/API:Main_page
   Promesas en Jquery http://api.jquery.com/promise/
-->
<html>
	<head>
	  <title>JSRxWikiTest</title>
	  <script src="lib/jquery-2.1.0.min.js"></script>
	  <script src="lib/rx.lite.js"></script>
	  <script>
		$(
		  function(){
			var $input = $('#input'),
				$results = $('#results');
            alert('loading');
			/* Only get the value from each key up */
			var keyups = Rx.Observable.fromEvent($input, 'keyup')
				.map(function (e) {
					return e.target.value;
				})
				.filter(function (text) {
					return text.length > 2;
				});

			/* Now throttle/debounce the input for 500ms */
			var throttled = keyups
				.throttle(500 /* ms */);

			/* Now get only distinct values, so we eliminate the arrows and other control characters */
			var distinct = throttled
				           .distinctUntilChanged();
			function searchWikipedia (term) {
				return $.ajax({
					url: 'http://en.wikipedia.org/w/api.php',
					dataType: 'jsonp',
					data: {
						action: 'opensearch',
						format: 'json',
						search: term
					}
				}).promise();
			}
            var suggestions = distinct
                              .flatMapLatest(searchWikipedia);
			suggestions.subscribe( function (data) {
				var res = data[1];

				/* Do something with the data like binding */
				$results.empty();

				$.each(res, function (_, value) {
					$('<li>' + value + '</li>').appendTo($results);
				});
			}, function (error) {
				/* handle any errors */
				$results.empty();

				$('<li>Error: ' + error + '</li>').appendTo($results);
			});
		});
	  </script>
	</head>
	<body>
		Search:<input id="input"/><br/>
		<div id="results">
		</div>
	</body>
</html>